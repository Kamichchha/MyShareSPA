(function(){angular.module("myShareApp",["ngRoute","ui.bootstrap"]);var t=function(t,e){t.when("/",{templateUrl:"home/home.view.html",controller:"stockListCtrl",controllerAs:"stockListVM"}).when("/stock/:stockId",{templateUrl:"stock-details/stock-details.view.html",controller:"stockDetailsCtrl",controllerAs:"vm"}).when("/about",{templateUrl:"about/about.view.html",controller:"aboutCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"common/auth/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"common/auth/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});e.html5Mode(true)};angular.module("myShareApp").config(["$routeProvider","$locationProvider",t])})();(function(){t.$inject=["$scope","stockService","getLocationService","$uibModal","authentication"];function t(t,e,o,r,a){stockListVM=this;stockListVM.message="Loading stocks list";stockListVM.pageHeader={title:"MyShare",strapLine:"    Ideas that can change your life..."};stockListVM.isLoggedIn=a.isLoggedIn();stockListVM.loadData=function(){e.getData().then(function(t){stockListVM.stockList=t.data;stockListVM.message=t.data.length>0?"":"No stocks found."},function(t){stockListVM.message="Something went wrong!!!"})};stockListVM.loadData();stockListVM.addStockForm=function(){var t=r.open({templateUrl:"stock-details/add-stock.modal.html",controller:"addStockCtrl",controllerAs:"vm",size:"lg"});t.result.then(function(t){stockListVM.stockList.push(t)})};stockListVM.updateStockForm=function(t){var e=r.open({templateUrl:"stock-details/update-stock.modal.html",controller:"updateStockCtrl",controllerAs:"vm",size:"lg",resolve:{updateData:function(){return{stockId:t}}}});e.result.then(function(t){stockListVM.loadData()})};stockListVM.deleteStock=function(t){e.deleteStock(t).success(function(){stockListVM.loadData()}).error(function(t){console.log(t)})};stockListVM.loadLocation=function(e){t.$apply(function(){stockListVM.locMessage="You'r at : "+e.coords.latitude+" ,"+e.coords.longitude})};stockListVM.errorLocation=function(e){t.$apply(function(){stockListVM.locMessage=""})};stockListVM.noLocation=function(){t.$apply(function(){stockListVM.locMessage="Browser doesn't support geolocation"})}}angular.module("myShareApp").controller("stockListCtrl",t)})();(function(){t.$inject=["authentication","$location"];function t(t,e){var o=this;o.credentials={name:"",email:"",password:""};o.pageHeader={title:"Register User"};o.returnPage=e.search().page||"/";o.addUser=function(){o.error="";if(!o.credentials.name||!o.credentials.email||!o.credentials.password){o.error="All fields required, try again.";return false}var r={name:o.credentials.name,email:o.credentials.email,password:o.credentials.password};t.register(r).success(function(t){e.search("page",null);e.path(o.returnPage)}).error(function(t){o.error=t.message.message})}}angular.module("myShareApp").controller("registerCtrl",t)})();(function(){t.$inject=["authentication","$location"];function t(t,e){var o=this;o.credentials={email:"",password:""};o.error="";o.pageHeader={title:"Log In"};o.returnPage=e.search().page||"/";o.loginUser=function(){o.error="";if(!o.credentials.email||!o.credentials.password){o.error="All fields required, try again.";return false}var r={email:o.credentials.email,password:o.credentials.password};t.login(r).success(function(t){e.search("page",null);e.path(o.returnPage)}).error(function(t){o.error=t.message.message})}}angular.module("myShareApp").controller("loginCtrl",t)})();(function(){t.$inject=["$window","$http"];function t(t,e){var o=function(e){t.localStorage["authToken"]=e};var r=function(){return t.localStorage["authToken"]};var a=function(t){return e.post("/api/login",t).success(function(t){o(t.token)})};var n=function(t){return e.post("/api/register",t).success(function(t){o(t.token)})};var c=function(){t.localStorage.removeItem("authToken")};var i=function(){var e=r();if(e){var o=JSON.parse(t.atob(e.split(".")[1]));return o.exp>Date.now()/1e3}else return false};var s=function(){if(i()){var e=r();var o=JSON.parse(t.atob(e.split(".")[1]));return{name:o.name,email:o.email}}};return{getToken:r,saveToken:o,login:a,register:n,logout:c,isLoggedIn:i,currentUser:s}}angular.module("myShareApp").service("authentication",t)})();(function(){t.$inject=["authentication","$location"];function t(t,e){var o=this;o.currentPath=e.path();o.isLoggedIn=t.isLoggedIn();o.currentUser=t.currentUser();o.logOut=function(){t.logout();e.path("/login")}}angular.module("myShareApp").controller("navigationCtrl",t)})();(function(){t.$inject=["stockService","$uibModal","$routeParams","authentication"];function t(t,e,o,r){vm=this;vm.stockId=o.stockId;vm.pageHeader={title:"Stock details: "};vm.isLoggedIn=r.isLoggedIn();t.getStockById(vm.stockId).success(function(t){vm.stock=t;vm.pageHeader.strapLine=stock.stockName}).error(function(t){console.log(t)});vm.popUpReviewForm=function(){var t=e.open({templateUrl:"review/add-review.modal.html",controller:"addReviewModalCtrl",controllerAs:"vm",resolve:{stockData:function(){return{stockId:vm.stockId,stockName:vm.stock.stockName}}}});t.result.then(function(t){vm.stock.reviews.push(t)})};vm.content={title:"About Us",data:"    Ideas that can change your life..."}}angular.module("myShareApp").controller("stockDetailsCtrl",t)})();(function(){t.$inject=["stockService","$uibModalInstance"];function t(t,e){var o=this;o.addStock=function(){o.error="";o.stockData={stockName:o.stockName,stockCode:o.stockCode,volume:o.volume,currPrice:o.currPrice,wkHigh52:o.wk52High,wkLow52:o.wk52Low};o.stockData.category=[];o.stockData.category.push(o.industry);o.stockData.category.push(o.sector);t.addStock(o.stockData).success(function(t){e.close(t)}).error(function(t){o.error="Error saving stock, please try again";return false})};o.onCancel=function(){e.dismiss("cancel")}}angular.module("myShareApp").controller("addStockCtrl",t)})();(function(){t.$inject=["stockService","updateData","$uibModalInstance"];function t(t,e,o){var r=this;r.stockId=e.stockId;t.getStockById(r.stockId).success(function(t){r.stockData=t;r.stockData.industry=t.category[0];r.stockData.sector=t.category[1]}).error(function(t){console.log(t)});r.onUpdate=function(){r.error="";r.updatedData={stockName:r.stockData.stockName,stockCode:r.stockData.stockCode,volume:r.stockData.volume,currPrice:r.stockData.currPrice,wkHigh52:r.stockData.wkHigh52,wkLow52:r.stockData.wkLow52};r.updatedData.category=[];r.updatedData.category.push(r.stockData.industry);r.updatedData.category.push(r.stockData.sector);t.updateStock(r.stockId,r.updatedData).success(function(t){o.close(t);return false}).error(function(t){r.error="Error updating stock, please try again";return false})};r.onCancel=function(){o.dismiss("cancel")}}angular.module("myShareApp").controller("updateStockCtrl",t)})();(function(){function t(){vm=this;vm.pageHeader={title:"About Us"};vm.content={data:"    Ideas that can change your life..."}}angular.module("myShareApp").controller("aboutCtrl",t)})();(function(){t.$inject=["$uibModalInstance","stockData","stockService"];function t(t,e,o){var r=this;r.stockData=e;r.formData={};r.onSubmit=function(){r.formData.error="";if(!r.formData.name||!r.formData.comment){r.formData.error="All fields required, please try again";return false}else{r.saveData(r.stockData.stockId,r.formData);return false}};r.modal={cancel:function(){t.dismiss("cancel")},close:function(e){t.close(e)}};r.saveData=function(t,e){o.addReviewById(t,{author:e.name,comment:e.comment}).success(function(t){r.modal.close(t)}).error(function(t){console.log(t);r.formData.error="Error saving review, please try again"})}}angular.module("myShareApp").controller("addReviewModalCtrl",t)})();(function(){var t=function(){var t=function(t,e,o){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(t,e)}else{o()}};return{getLocData:t}};angular.module("myShareApp").service("getLocationService",t)})();(function(){t.$inject=["$http","authentication"];function t(t,e){var o=function(){return t.get("/api/stock",{headers:{Authorization:"Bearer "+e.getToken()}})};var r=function(o){return t.get("/api/stock/"+o,{headers:{Authorization:"Bearer "+e.getToken()}})};var a=function(o,r){return t.post("/api/stock/"+o+"/comment",r,{headers:{Authorization:"Bearer "+e.getToken()}})};var n=function(o){return t.post("/api/stock",o,{headers:{Authorization:"Bearer "+e.getToken()}})};var c=function(o,r){return t.put("/api/stock/"+o,r,{headers:{Authorization:"Bearer "+e.getToken()}})};var i=function(o){return t.delete("/api/stock/"+o,{headers:{Authorization:"Bearer "+e.getToken()}})};return{getData:o,getStockById:r,addReviewById:a,addStock:n,updateStock:c,deleteStock:i}}angular.module("myShareApp").service("stockService",t)})();(function(){var t=function(){return function(t){var e=t.toString();if(e.length<=3){return t}t=e.substring(0,e.length-3)+","+e.substring(e.length-3);return t}};angular.module("myShareApp").filter("formatVolume",t)})();(function(){var t=function(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader.html"}};angular.module("myShareApp").directive("pageHeader",t)})();(function(){var t=function(){return{restrict:"EA",templateUrl:"/common/directives/myShareNavigation.html",controller:"navigationCtrl as navvm"}};angular.module("myShareApp").directive("navigation",t)})();(function(){var t=function(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric.html"}};angular.module("myShareApp").directive("footerGeneric",t)})();